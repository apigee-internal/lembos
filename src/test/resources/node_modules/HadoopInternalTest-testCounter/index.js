'use strict';

var assert = require('assert');
var counterGroupName = 'Test Counters';
var counterName = 'Test Counter';

module.exports = {
  mapSetup: function (context, cb) {
    var counter = context.getCounter(counterGroupName, counterName);

    assert.equal(counterName, counter.getDisplayName());
    assert.equal(counterName, counter.getName());
    assert.equal(0, counter.getValue());

    cb();
  },

  map: function (key, value, context, cb) {
    context.getCounter(counterGroupName, counterName).increment(1);

    cb();
  },

  mapCleanup: function (context, cb) {
    var counter = context.getCounter(counterGroupName, counterName);

    assert.equal(1, counter.getValue());

    try {
      counter.setValue();
    } catch (err) {
      assert.equal('One argument expected', err.message);
    }

    try {
      counter.setValue('1');
    } catch (err) {
      assert.equal('First argument must be a number', err.message);
    }

    counter.setValue(0);

    assert.equal(0, counter.getValue());

    cb();
  }
};
