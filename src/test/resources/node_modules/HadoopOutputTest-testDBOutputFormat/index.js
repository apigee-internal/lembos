'use strict';

var assert = require('assert');
var DBOutputFormat = require('hadoop-output').DBOutputFormat;
var Job = require('hadoop-job').Job;

function testSetOutput () {
  var job = new Job();
  var tableName = 'USERS';

  // Test wrong arguments
  try {
    DBOutputFormat.setOutput();
  } catch (err) {
    assert.equal('Three arguments expected', err.message);
  }

  try {
    DBOutputFormat.setOutput(job);
  } catch (err) {
    assert.equal('Three arguments expected', err.message);
  }

  try {
    DBOutputFormat.setOutput(job, tableName);
  } catch (err) {
    assert.equal('Three arguments expected', err.message);
  }

  try {
    DBOutputFormat.setOutput('job', tableName, 1);
  } catch (err) {
    assert.equal('First argument must be a Job object', err.message);
  }

  try {
    DBOutputFormat.setOutput(job, tableName, '1');
  } catch (err) {
    assert.equal('Third argument must be an array or a number', err.message);
  }

  // Test
  DBOutputFormat.setOutput(job, tableName, 1);

  DBOutputFormat.setOutput(job, tableName, ['name', 'email']);
}

module.exports.testDBOutputFormat = function (cb) {

  try {
    testSetOutput();
  } catch (err) {
    if (err.stack) {
      console.error(err.stack);
    }
    throw new Error(err.message);
  }

  cb();

};