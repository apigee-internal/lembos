'use strict';

var assert = require('assert');

module.exports = {
  map: function (key, value, context, cb) {
    try {
      // Test wrong number of arguments
      try {
        context.getCounter();
      } catch (err) {
        assert.equal('Two arguments expected', err.message);
      }

      try {
        context.getCounter(null, '');
      } catch (err) {
        assert.equal('First argument is not optional', err.message);
      }

      try {
        context.getCounter('', null);
      } catch (err) {
        assert.equal('Second argument is not optional', err.message);
      }

      // Make sure the counter returned is of the proper type (Counter tests are in its own module)
      assert.strictEqual('[object Counter]', context.getCounter('lembos-test', 'Test Counter').toString());

      cb();
    } catch (err) {
      if (err.stack) {
        console.error(err.stack);
      }
      cb(err);
    }
  }
};
